{% extends "base.html" %}
{% from "macros.html" import post_stats %}

{% block title %}Post{% endblock %}
{% block content %}

<div class="row">
	<div class="col-xs-10 col-xs-offset-1">
		<div class="row post-summary-header">
			<picture class="col-xs-12">
				<source media="(min-width: 768px)" srcset="/postimg/{{post.header_image_med}} 1x, /postimg/{{post.header_image_large}} 2x">
				<source media="(min-width: 375px)" srcset="/postimg/{{post.header_image_small}} 1x, /postimg/{{post.header_image_med}} 2x">
				<img class="center-block post-image img-responsive" src="/postimg/{{post.header_image_thumb}}">
			</picture>
			<div class="col-xs-12 post-summary-title"><h3>{{post.title}}</h3></div>
		</div>
		<div class="row post-summary-info">
			<div class="col-xs-6 post-author"><h6>{{post.get_author_name()}}</h6></div>
			<div class="col-xs-6 text-right post-stats">
				{{ post_stats(post.comment_num, post.likes | length, post.views) }}
			</div>
		</div>
		<div class="row post-summary-content">
			<div class="col-xs-12 post-summary-content"><p>{{post.get_formatted_text() | safe }}</p></div>
		</div>
		<div class="row row-eq-height post-summary-footer">
			<div class="col-xs-6 post-summary-date pull-center"><h5><small>{{post.created.date().strftime("%b %d, %Y")}}</small></h5></div>
		</div>
	</div>
</div>

{% if user %}

	{% if post.user_is_author(user.key().id()) %}

	<div class="row">
		<div class="col-xs-10 col-xs-offset-1">
			<a href="/edit/{{post.key().id()}}">Edit this post</a>
		</div>
	</div>

	{% else %}

	<div class="row">
		<div class="col-xs-10 col-xs-offset-1">
			<form method="post">
				{% if user_liked %}
				<button type="submit" name="submit" value="unlike" class="btn btn-default pull-right">
					<i class="fa fa-thumbs-down" aria-hidden="true"></i>Unlike this post
				</button>
				{% else %}
				<button type="submit" name="submit" value="like" class="btn btn-default pull-right">
					<i class="fa fa-thumbs-up" aria-hidden="true"></i>Like this post
				</button>
				{% endif %}
			</form>
		</div>
	</div>

	{% endif %}

{% endif %}
<hr>
<div class="row comments-hdr">
	<div class="col-xs-10 col-xs-offset-1">
	<h2>Comments</h2>
	<hr class="comments-hdr-hr">
	</div>
</div>

<div class="row">
	<div class="col-xs-10 col-xs-offset-1">

{% for comment in post.get_comments() %}
	
		<div class="row comment">
			<div class="hidden-xs col-sm-2">
				<img class="img-responsive center-block img-circle" src="/userimg/{{comment.user_id}}">
			</div>
			<div class="col-xs-12 col-sm-10">
				<h4>{{comment.get_user_name()}}</h4>
				<p>{{comment.get_formatted_text() | safe}}</p>


				{% if user and user.key().id() == comment.user_id %}
				<form action="/uncomment" method="post">
					<input type="text" hidden name="comment_id" value="{{comment.key().id()}}">
					<button class="btn btn-danger pull-right" type="submit" name="submit" value="uncomment">Delete this comment</button>
				</form>
				{% endif %}
			</div>
		</div>
{% endfor %}

		{% if user %}
		<div class="row">
			<div class="col-xs-12">
				<form method="post">
					<div class="form-group">
					    <textarea class="form-control" name="comment" id="comment" placeholder="Leave a comment..."></textarea>
			  		</div>
			  		<button type="submit" name="submit" value="comment" class="btn btn-default pull-right">Submit</button>
				</form>
			</div>
		</div>
		{% else %}
		<div class="row">
			<div class="col-xs-12">
				<p>Log in to post comments...</p>
			</div>
		</div>
		{% endif %}

	</div>
</div>
{% endblock %}

